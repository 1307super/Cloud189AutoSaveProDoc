---
title: "反代配置"
weight: 4
mermaid: true
menu:
  main:
    parent: "usage"
    name: "反代配置"
    weight: 4
---



## 一、反代功能简介  
本系统反代功能与 `emby2Alist` 等工具类似，但更轻量高效，核心功能为 **播放请求拦截与直链返回**，搭配「玄鲸极速」模式可实现免转存直连播放，大幅提升播放体验。  


## 二、为什么选择302反代？  
### 传统播放流程（无反代）  

{{< mermaid >}}
graph LR
    User((用户)) -->|发起播放请求| Server[业务服务器]
    Server -->|解析播放地址| Emby[Emby媒体服务器]
    Emby -->|下载视频流| Download[服务器中转]
    Download -->|推送视频流| Player((播放器))
{{< /mermaid >}}


### 302 反代流程（推荐）

{{< mermaid >}}
graph LR
    User((用户)) -->|发起播放请求| Server[业务服务器]
    Server -->|302反代拦截| Proxy[反代服务]
    Proxy -->|解析直链| DirectLink[获取资源直链]
    DirectLink -->|返回直链| Player((播放器))
    Player -->|直接拉取| Source[资源]
{{< /mermaid >}}

#### 由此可见，302反代的核心优势在于：
- **资源直链获取**：无需中转，直接获取资源的直链，实现资源的直接播放。
- **播放速度快**：无需等待资源转存，直接获取资源的直链，实现资源的直接播放。


## 三、反代功能特性
#### **1. 智能兼容模式**
 - **玄鲸极速模式**：无需任何配置，自动生成优化直链。
 - **Alist 兼容模式**：若使用 Alist 生成的 STRM 文件，只需确保文件内地址可访问，反代服务自动解析。

#### **2. 灵活路径替换（pathMap）**
当资源路径与播放端不匹配时，可通过 pathMap 规则进行替换，格式为 旧路径规则=>新路径规则。

**示例场景：**

**场景 1：域名 / 端口替换**

**需求**  Alist 访问地址为 http://alist:5244/d，替换为 http://127.0.0.1:3000/d

```yaml
strm:
  pathMap:
    - alist:5244/d => 127.0.0.1:3000/d  # 替换域名和端口
```

**场景 2：路径前缀去除**

**需求：** 去除路径前缀 /remote
```yaml
strm:
  pathMap:
    - /remote/ => /  # 去除路径前缀
```

支持配置几多个规则, 例如:
```yaml
strm:
  pathMap:
    - alist:5244/d => 127.0.0.1:3000/d  # 替换域名和端口
    - /remote/ => /  # 去除路径前缀
```

#### **3. 缓存优化**
**直链缓存**：通过 redirectCacheTTL 配置直链有效期（默认 50分钟），减少重复解析消耗。


## 四、使用建议
 - **优先启用玄鲸极速：** 适合新手用户，无需配置即可实现直连。
 - **复杂路径场景：** 通过 pathMap 解决地址不匹配问题，支持实时生效。
 - **日志排查：** 开启 debug 日志级别，可快速定位路径替换或直链解析问题。
 
 通过 302 反代与玄鲸极速的结合，系统可实现 **“零中转带宽消耗”** 的高效播放，尤其适合带宽有限或高并发场景。